# Github Actions For Vercel

I am using Jest to run tests for a [[nextjs]] site on Vercel using three strategies:

1. Import the component that a page runs and test with [[jest]] and [@testing-library](https://testing-library.com/docs/react-testing-library/intro).
2. Use Jest to unit test utility functions my API routes use.
3. Use fetch to call the API routes and test results.

## Testing Vercel API routes

This approach is inspired by [[laravel]][http testing](https://laravel.com/docs/7.x/http-tests)//laravel.com/docs/7.x/http

At first I hardcoded the URL for my current PR's preview URL into the Github action.

```js
let appUrl = "https://whatever.jpollock412.vercel.app";
test("Gets a 200", async () => {
	expect.assertions(1);
	await fetch(`${appUrl}/api/hello`)
		.then((r) => {
			expect(r.status).toBe(200);
		})
		.catch((e) => console.log(e));
});
```

That only worked beacuse I already had the PR. It's not reusable between PRs. Also, it runs the test on the previous commit in the likely case the Github action runs before the deployment is completed. I used [this action to wait for the preview URL to update](https://github.com/patrickedqvist/wait-for-vercel-preview)

[//begin]: # "Autogenerated link references for markdown compatibility"
[laravel]: laravel "Laravel"
[//end]: # "Autogenerated link references"
